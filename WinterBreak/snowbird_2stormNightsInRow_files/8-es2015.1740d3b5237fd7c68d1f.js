(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{NqrH:function(e,i,t){"use strict";t.r(i),t.d(i,"ArchiveModule",function(){return _});var a=t("ofXK"),r=t("bTqV"),s=t("tyNb"),d=t("sYmb"),o=t("ZxDN"),c=t("dBhb"),n=t("0Faz"),l=t("ZIxz"),h=t("mrSG"),u=t("VfN6"),b=t("quSY"),v=t("VRyK"),g=t("IzEk"),m=t("lJxs"),p=t("fXoL"),I=t("tk/3"),f=t("HlYp"),C=t("EK73");let S=(()=>{class e{constructor(e){this.httpClient=e}preloadImage$(e){return this.httpClient.get(e,{responseType:"blob"})}getCalendarFeed$(e=!1){return this.httpClient.get(e?`video/${f.a.archiveCalendar}`:f.a.archiveCalendar).pipe(Object(m.a)(e=>Object(C.a)(e)))}getSliderFeed$(e,i=!1){const t=i?`video/${f.a.archiveSlider}`:f.a.archiveSlider,a={params:new I.e({fromObject:{year:e.getFullYear().toString(),month:(e.getMonth()+1).toString(),day:e.getDate().toString(),range:"d"}})};return this.httpClient.get(t,a)}}return e.\u0275fac=function(i){return new(i||e)(p.Yb(I.b))},e.\u0275prov=p.Kb({token:e,factory:e.\u0275fac}),e})();var V=t("Dp68"),w=t("2Vo4"),O=t("LRne"),L=t("vkgz");let k=(()=>{class e{constructor(e){this.http=e,this.currentVideo$=new w.a(null),this.requestInProgress=!1}load$(e,i){if(this.requestInProgress)return;const t=this.findVideoInStructureMemory(i);return t?(this.currentVideo$.next(t),Object(O.a)(!0)):(this.requestInProgress=!0,this.loadStructure$(e).pipe(Object(m.a)(e=>{if(!e.videos||e.videos.length<0)return!1;this.structure=Object.assign(Object.assign({},this.structure),e);const t=this.findVideoInStructureMemory(i);return this.currentVideo$.next(t),!0})))}getCurrentVideo$(){return this.currentVideo$.asObservable()}loadStructure$(e){e.setHours(23,59,59,999);const i={params:{days:"0",to:e.toISOString()}};return this.http.get(`video/${f.a.structure}`,i).pipe(Object(L.a)(()=>this.requestInProgress=!1))}findVideoInStructureMemory(e){var i,t;return null===(t=null===(i=this.structure)||void 0===i?void 0:i.videos)||void 0===t?void 0:t.find(i=>i.id===e)}}return e.\u0275fac=function(i){return new(i||e)(p.Yb(I.b))},e.\u0275prov=p.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var P=t("wbTk"),j=t("kTrY");function D(e,i){if(1&e){const e=p.Vb();p.Ub(0,"div"),p.Ub(1,"app-ui-camera-calendar",4),p.bc("itemChange",function(i){return p.uc(e),p.fc().onSliderImageChange(i)})("dateChange",function(i){return p.uc(e),p.fc().onDateChangeImage(i)})("loadMain",function(i){return p.uc(e),p.fc().onImageLoad(i)}),p.Tb(),p.Tb()}if(2&e){const e=p.fc();p.Cb(1),p.lc("isHorizontalLayout",!0)("calendarDates",e.calendarDates)("sliderItems",e.sliderImages)("imagePreviewUrl",e.loadedPreviewImage)("dateSelected",e.loadedDateImage)("isPanorama",e.isImage360)("isLoading",e.isImageLoaderVisible)("disabled",e.disableCalendarImageInputs)("isAutorotateActive",e.isAutorotateActive)}}function U(e,i){if(1&e){const e=p.Vb();p.Ub(0,"div"),p.Ub(1,"app-ui-camera-calendar",5),p.bc("itemChange",function(i){return p.uc(e),p.fc().onSliderVideoChange(i)})("dateChange",function(i){return p.uc(e),p.fc().onDateChangeVideo(i)})("loadMain",function(i){return p.uc(e),p.fc().onVideoLoad(i)}),p.Tb(),p.Tb()}if(2&e){const e=p.fc();p.Cb(1),p.lc("calendarDates",e.calendarDatesVideo)("sliderItems",e.sliderVideos)("imagePreviewUrl",e.loadedPreviewVideo)("dateSelected",e.loadedDateVideo)("isLoading",e.isVideoLoaderVisible)("disabled",e.disableCalendarVideoInputs)}}function y(e,i){if(1&e){const e=p.Vb();p.Ub(0,"div",6),p.Ub(1,"button",7),p.bc("click",function(){return p.uc(e),p.fc().openTab("images")}),p.Dc(2," Photos "),p.Tb(),p.Ub(3,"button",7),p.bc("click",function(){return p.uc(e),p.fc().openTab("videos")}),p.Dc(4," Videos "),p.Tb(),p.Tb()}if(2&e){const e=p.fc();p.Cb(1),p.Gb("mat-stroked-button--active","images"===e.selectedTab),p.Cb(2),p.Gb("mat-stroked-button--active","videos"===e.selectedTab)}}var F=function(e){return e.images="images",e.videos="videos",e}({});let T=(()=>{let e=class{constructor(e,i,t,a,r,s){this.activatedRoute=e,this.router=i,this.cdr=t,this.archiveService=a,this.imageStructureService=r,this.videoStructureService=s,this.selectedTab=F.images,this.hasVideo=!1,this.imageSliderFeedSubscription=new b.a,this.imagePreloadImagesSubscription=new b.a,this.videoSliderFeedSubscription=new b.a,this.videoPreloadImagesSubscription=new b.a,this.isImageLoaderVisible=!0,this.isVideoLoaderVisible=!0,this.imageLoadedPreviews=[]}ngOnInit(){this.handleArchiveSettingsResolver(),this.loadCalendarAvailableDates(),this.loadCalendarAvailableDatesVideo(),this.getCurrentMainImageLoaded()}ngOnDestroy(){this.clearCashedImages(),this.clearCashedVideoImages()}onDateChangeImage(e){this.disableCalendarImageInputs=!0,this.selectedImage=null,this.imageLoadedPreviews=[],this.isImageLoaderVisible=!0,this.loadedDateImage=e,this.cdr.markForCheck(),this.imageSliderFeedSubscription.unsubscribe(),this.imagePreloadImagesSubscription.unsubscribe(),this.imageSliderFeedSubscription=this.archiveService.getSliderFeed$(e).pipe(Object(u.b)(this)).subscribe(e=>{this.clearCashedImages(),this.sliderImages=Object.assign({},e.slider_feed),this.disableCalendarImageInputs=!1,this.cdr.markForCheck(),this.imagePreloadImagesSubscription=this.preloadImagesPreview$(e.slider_feed).pipe(Object(u.b)(this)).subscribe(e=>{var i;this.imageLoadedPreviews=[...this.imageLoadedPreviews,e],(null===(i=this.selectedImage)||void 0===i?void 0:i.id)===e.id&&(this.loadedPreviewImage=e.previewUrl,this.isImageLoaderVisible=!1,this.cdr.markForCheck())})})}onDateChangeVideo(e){this.disableCalendarVideoInputs=!0,this.selectedVideoImage=null,this.videoLoadedPreviews=[],this.isVideoLoaderVisible=!0,this.loadedDateVideo=e,this.cdr.markForCheck(),this.videoSliderFeedSubscription.unsubscribe(),this.videoPreloadImagesSubscription.unsubscribe(),this.videoSliderFeedSubscription=this.archiveService.getSliderFeed$(e,!0).pipe(Object(u.b)(this)).subscribe(e=>{this.clearCashedVideoImages(),this.sliderVideos=Object.assign({},e.slider_feed),this.disableCalendarVideoInputs=!1,this.cdr.markForCheck(),this.videoPreloadImagesSubscription=this.preloadVideosPreview$(e.slider_feed).pipe(Object(u.b)(this)).subscribe(e=>{var i;this.videoLoadedPreviews=[...this.videoLoadedPreviews,e],(null===(i=this.selectedVideoImage)||void 0===i?void 0:i.id)===e.id&&(this.loadedPreviewVideo=e.previewUrl,this.isVideoLoaderVisible=!1,this.cdr.markForCheck())})})}clearCashedImages(){this.imageLoadedPreviews&&Object.values(this.imageLoadedPreviews).forEach(e=>URL.revokeObjectURL(e.previewUrl))}clearCashedVideoImages(){this.videoLoadedPreviews&&Object.values(this.videoLoadedPreviews).forEach(e=>URL.revokeObjectURL(e.previewUrl))}onSliderImageChange(e){var i;this.selectedImage=e,this.isImageLoaderVisible=!0,this.cdr.markForCheck();const t=null===(i=this.imageLoadedPreviews)||void 0===i?void 0:i.find(i=>i.id===e.id);t&&(this.loadedPreviewImage=t.previewUrl,this.isImageLoaderVisible=!1,this.cdr.markForCheck())}onSliderVideoChange(e){var i;this.selectedVideoImage=e,this.isVideoLoaderVisible=!0,this.cdr.markForCheck();const t=null===(i=this.videoLoadedPreviews)||void 0===i?void 0:i.find(i=>i.id===e.id);t&&(this.loadedPreviewVideo=t.previewUrl,this.isVideoLoaderVisible=!1,this.cdr.markForCheck())}onImageLoad(e){this.imageStructureService.load(e),this.router.navigateByUrl("/")}onVideoLoad(e){this.videoStructureService.load$(this.loadedDateVideo,e).pipe(Object(u.b)(this)).subscribe(e=>{e&&this.router.navigateByUrl("archive/video")})}openTab(e){this.selectedTab=e}getCurrentMainImageLoaded(){this.imageStructureService.getCurrentImage$().pipe(Object(u.b)(this),Object(g.a)(1)).subscribe(e=>{this.loadedDateImage=new Date(1e3*e.datetime),this.onDateChangeImage(this.loadedDateImage)})}loadCalendarAvailableDates(){this.archiveService.getCalendarFeed$().pipe(Object(u.b)(this)).subscribe(e=>{this.calendarDates=e,this.cdr.markForCheck()})}loadCalendarAvailableDatesVideo(){this.archiveService.getCalendarFeed$(!0).pipe(Object(u.b)(this)).subscribe(e=>{Object.keys(e).length<=0||(this.calendarDatesVideo=e,this.showViewTab(),this.onDateChangeVideo(this.getLastAvailableDateFromCalendar(e)))})}showViewTab(){this.hasVideo=!0,this.selectedTab=F.images,this.cdr.markForCheck()}getLastAvailableDateFromCalendar(e){if(Object.keys(e).length<=0)return;const i=Math.max(...Object.keys(e).map(e=>parseInt(e,10)));return e[i]instanceof Date?e[i]:this.getLastAvailableDateFromCalendar(e[i])}preloadImagesPreview$(e){const i=Object.values(e).reverse().map(e=>this.archiveService.preloadImage$(e.structure.thumbnail.url_full).pipe(Object(m.a)(i=>({previewUrl:URL.createObjectURL(i),id:e.id}))));return Object(v.a)(...i)}preloadVideosPreview$(e){const i=Object.values(e).reverse().map(e=>this.archiveService.preloadImage$(e.structure.thumbnail.url_full).pipe(Object(m.a)(i=>({previewUrl:URL.createObjectURL(i),id:e.id}))));return Object(v.a)(...i)}handleArchiveSettingsResolver(){this.activatedRoute.data.pipe(Object(u.b)(this)).subscribe(e=>{this.isImage360=e.archiveSettings.isImage360,this.isAutorotateActive=e.archiveSettings.isAutorotateActive})}};return e.\u0275fac=function(i){return new(i||e)(p.Ob(s.a),p.Ob(s.d),p.Ob(p.h),p.Ob(S),p.Ob(V.a),p.Ob(k))},e.\u0275cmp=p.Ib({type:e,selectors:[["app-archive"]],decls:7,vars:8,consts:[["routerPopupSize","large",3,"routerPopupTitle"],[1,"archive"],[4,"ngIf"],["class","archive-tab",4,"ngIf"],[3,"isHorizontalLayout","calendarDates","sliderItems","imagePreviewUrl","dateSelected","isPanorama","isLoading","disabled","isAutorotateActive","itemChange","dateChange","loadMain"],[3,"calendarDates","sliderItems","imagePreviewUrl","dateSelected","isLoading","disabled","itemChange","dateChange","loadMain"],[1,"archive-tab"],["mat-stroked-button","",1,"archive-tab__button",3,"click"]],template:function(e,i){1&e&&(p.Ub(0,"app-router-popup",0),p.gc(1,"titlecase"),p.gc(2,"translate"),p.Ub(3,"div",1),p.Bc(4,D,2,9,"div",2),p.Bc(5,U,2,6,"div",2),p.Bc(6,y,5,4,"div",3),p.Tb(),p.Tb()),2&e&&(p.lc("routerPopupTitle",p.hc(1,4,p.hc(2,6,"_archive"))),p.Cb(4),p.lc("ngIf","images"===i.selectedTab),p.Cb(1),p.lc("ngIf","videos"===i.selectedTab),p.Cb(1),p.lc("ngIf",i.hasVideo))},directives:[P.a,a.m,j.a,r.a],pipes:[a.u,d.d],styles:["[_nghost-%COMP%]{display:block;min-height:100%}.archive-tab[_ngcontent-%COMP%]{box-sizing:border-box;display:flex;justify-content:space-evenly;padding:18px 0 0;border-top:1px solid rgba(60,66,91,.2)}.archive-tab__button[_ngcontent-%COMP%]{width:30%;min-width:120px}"],changeDetection:0}),e=Object(h.a)([Object(u.a)()],e),e})();var $=t("itXk"),A=t("JikE");let M=(()=>{class e{constructor(e,i,t){this.router=e,this.settingsService=i,this.videoStructureService=t}resolve(e){const i=this.settingsService.getVideoSettings$(),t=this.videoStructureService.getCurrentVideo$();return Object($.b)([i,t]).pipe(Object(g.a)(1),Object(L.a)(([e,i])=>{e&&i||this.router.navigateByUrl("/")}),Object(m.a)(([e,i])=>({hasTeaser:e.hasTeaser,url:i.structure.original_video.url_full,posterUrl:i.structure.archiveprev,previewUrl:i.structure.archiveprev,datetime:new Date(1e3*i.datetime),autoplay:e.autoplay})))}}return e.\u0275fac=function(i){return new(i||e)(p.Yb(s.d),p.Yb(A.a),p.Yb(k))},e.\u0275prov=p.Kb({token:e,factory:e.\u0275fac}),e})(),_=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=p.Mb({type:e}),e.\u0275inj=p.Lb({providers:[S,M],imports:[[a.c,n.a,r.b,l.a,s.f.forChild([{path:"",component:T},{path:o.a.video,loadChildren:()=>t.e(3).then(t.bind(null,"0whj")).then(e=>e.VideoModule),data:{animation:!0,fullscreen:!0},resolve:{videoSettings:M}}]),c.a,d.c]]}),e})()}}]);