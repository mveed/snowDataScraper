(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{mONW:function(t,e,s){"use strict";s.r(e),s.d(e,"BestShotsModule",function(){return P});var r=s("ofXK"),o=s("tyNb"),i=s("sYmb"),c=s("dBhb"),h=s("0Faz"),a=s("mrSG"),n=s("VfN6"),u=s("fXoL"),l=s("tk/3"),p=s("2Vo4"),b=s("HlYp");let S=(()=>{let t=class{constructor(t){this.http=t,this.requestInProgress=!1,this.currentPage=0,this.isExhausted=!1,this.loadedBestShots=[],this.bestShotsStructure$=new p.a([])}getBestShotsStructure$(){return this.bestShotsStructure$.asObservable()}loadNextPage(){this.load(++this.currentPage)}load(t=0){this.requestInProgress||this.isExhausted||(this.requestInProgress=!0,this.loadStructure$(t).pipe(Object(n.b)(this)).subscribe(t=>{this.isExhausted=!t.more,this.loadedBestShots=[...this.loadedBestShots,...t.best_shots],this.bestShotsStructure$.next(this.loadedBestShots),this.requestInProgress=!1},()=>{this.requestInProgress=!1,this.isExhausted=!1}))}loadStructure$(t){const e={params:new l.e({fromObject:{page:t.toString()}})};return this.http.get(b.a.bestShots,e)}};return t.\u0275fac=function(e){return new(e||t)(u.Yb(l.b))},t.\u0275prov=u.Kb({token:t,factory:t.\u0275fac}),t=Object(a.a)([Object(n.a)()],t),t})();var d=s("Dp68"),g=s("wbTk"),f=s("TO3C"),m=s("zzDJ");function v(t,e){if(1&t){const t=u.Vb();u.Ub(0,"app-ui-camera-list",4),u.bc("onSelect",function(e){return u.uc(t),u.fc().loadBestShot(e)}),u.Tb()}if(2&t){const t=u.fc();u.lc("list",t.bestShotsList)}}function O(t,e){1&t&&u.Pb(0,"app-ui-spinner")}let B=(()=>{let t=class{constructor(t,e,s,r,o){this.activatedRoute=t,this.bestShotsService=e,this.imageStructureService=s,this.router=r,this.cdr=o}ngOnInit(){this.handleBestShotSettingsResolver(),this.bestShotsService.load(),this.fetchBestShotsStructure(),this.markBestShotActiveOnImageChange()}loadBestShot({id:t}){this.imageStructureService.load(t),this.router.navigate(["/"])}fetchMoreBestShots(){this.bestShotsService.loadNextPage()}onRouterPopupScroll(t){const e=t.target;100*e.scrollTop/(e.scrollHeight-e.offsetHeight)>75&&this.fetchMoreBestShots()}fetchBestShotsStructure(){this.bestShotsService.getBestShotsStructure$().pipe(Object(n.b)(this)).subscribe(t=>{this.bestShotsList=t.map(t=>{let e=t.structure.centerprev.url_full;return e&&(this.cameraAngle>250?e=e.replace("centerprev","thumbnail"):this.cameraAngle>180&&(e=e.replace("centerprev","archiveprev"))),{id:t.id,imgUrl:e,takenAt:new Date(1e3*t.datetime),active:!1,position:{angle:this.cameraAngle}}}),this.cdr.markForCheck()})}markBestShotActiveOnImageChange(){this.imageStructureService.getCurrentImage$().pipe(Object(n.b)(this)).subscribe(t=>{this.bestShotsList=this.bestShotsList.map(e=>(e.active=e.id===t.id,e)),this.cdr.markForCheck()})}handleBestShotSettingsResolver(){this.activatedRoute.data.pipe(Object(n.b)(this)).subscribe(t=>{this.cameraAngle=t.settings.cameraAngle||360})}};return t.\u0275fac=function(e){return new(e||t)(u.Ob(o.a),u.Ob(S),u.Ob(d.a),u.Ob(o.d),u.Ob(u.h))},t.\u0275cmp=u.Ib({type:t,selectors:[["app-best-shots"]],decls:7,vars:8,consts:[[3,"routerPopupTitle","routerPopupWatchScroll","onRouterPopupScroll"],[1,"best-shots"],[3,"list","onSelect",4,"ngIf","ngIfElse"],["preview",""],[3,"list","onSelect"]],template:function(t,e){if(1&t&&(u.Ub(0,"app-router-popup",0),u.bc("onRouterPopupScroll",function(t){return e.onRouterPopupScroll(t)}),u.gc(1,"titlecase"),u.gc(2,"translate"),u.Ub(3,"div",1),u.Bc(4,v,1,1,"app-ui-camera-list",2),u.Bc(5,O,1,0,"ng-template",null,3,u.Cc),u.Tb(),u.Tb()),2&t){const t=u.rc(6);u.lc("routerPopupTitle",u.hc(1,4,u.hc(2,6,"_best_shots")))("routerPopupWatchScroll",!0),u.Cb(4),u.lc("ngIf",null==e.bestShotsList?null:e.bestShotsList.length)("ngIfElse",t)}},directives:[g.a,r.m,f.a,m.a],pipes:[r.u,i.d],styles:["[_nghost-%COMP%]{display:block}.best-shots[_ngcontent-%COMP%]{min-height:80vh}"],changeDetection:0}),t=Object(a.a)([Object(n.a)()],t),t})(),P=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.Mb({type:t}),t.\u0275inj=u.Lb({providers:[S],imports:[[r.c,h.a,o.f.forChild([{path:"",component:B}]),c.a,i.c]]}),t})()}}]);