define(function(require){"use strict";var $=require("jquery"),dom={};require("slick");var carouselDragHandler=function(){var mouseDown=false,lastPageX,initPageX,direction="center",dom={};var currentSlideClass="slide-current";function init(props){initDom(props);attachHandlers()}function initDom(props){dom.carousel=props.dom.carousel;dom.slickList=props.dom.carousel.find(".slick-list")}function attachHandlers(){dom.slickList.off("mousedown.drag mousemove.drag mouseup.drag touchstart.drag touchmove.drag touchend.drag");dom.slickList.on("mousedown.drag touchstart.drag",function(){mouseDown=true});dom.slickList.on("touchmove.drag",function(e){cursorMoved(e.originalEvent.touches[0].pageX)});dom.slickList.on("mousemove.drag",function(e){cursorMoved(e.pageX)});dom.slickList.on("mouseup.drag touchend.drag",function(){mouseDown=false;initPageX=undefined;direction=undefined})}function cursorMoved(pageX){if(isDraggingSomewhereNew(pageX)){setNewCurrentSlidesOnDragPosition()}}function isDraggingSomewhereNew(pageX){if(pageX===lastPageX){return false}lastPageX=pageX;var dragBuffer=50;if(mouseDown&&initPageX===undefined){initPageX=pageX}else if(mouseDown&&initPageX!==undefined){if(pageX>initPageX+dragBuffer&&direction!=="right"){direction="right";return true}else if(pageX<initPageX-dragBuffer&&direction!=="left"){direction="left";return true}else if(pageX>=initPageX-dragBuffer&&pageX<=initPageX+dragBuffer&&(direction!=="center"&&direction!==undefined)){direction="center";return true}}return false}function setNewCurrentSlidesOnDragPosition(){var currSlide=dom.carousel.slick("slickCurrentSlide");var indexesToRemoveCurrentClass=[dom.carousel.slick("slickCurrentSlide")];var indexesToAddCurrentClass=[];var slidesToShow=dom.carousel.slick("slickGetOption","slidesToShow");var slideCount=dom.carousel.find(".slick-slide").length;var isOddNumberLastSlide=slidesToShow>1?currSlide+slidesToShow===slideCount-1:false;var lmod,rmod,cmod;for(var smod=isOddNumberLastSlide?slidesToShow:1;smod<slidesToShow;smod++){indexesToRemoveCurrentClass.push(indexesToRemoveCurrentClass[0]+smod)}if(direction==="left"){for(lmod=1;lmod<=slidesToShow;lmod++){indexesToAddCurrentClass.push(indexesToRemoveCurrentClass[0]+(slidesToShow-1)+lmod)}}else if(direction==="right"){for(rmod=1;rmod<=slidesToShow;rmod++){indexesToAddCurrentClass.push(indexesToRemoveCurrentClass[0]-rmod)}}else if(direction==="center"){for(cmod=0;cmod<slidesToShow;cmod++){indexesToAddCurrentClass.push(indexesToRemoveCurrentClass[cmod])}var start=indexesToRemoveCurrentClass[0];indexesToRemoveCurrentClass=[];for(cmod=0;cmod<slidesToShow;cmod++){indexesToRemoveCurrentClass.push(start+slidesToShow+cmod);indexesToRemoveCurrentClass.push(start-cmod-1)}indexesToRemoveCurrentClass=indexesToRemoveCurrentClass.filter(function(f){return f>=0})}indexesToRemoveCurrentClass.forEach(function(ci){dom.carousel.find(".slick-slide").eq(ci).removeClass(currentSlideClass)});indexesToAddCurrentClass.forEach(function(ci){dom.carousel.find(".slick-slide").eq(ci).addClass(currentSlideClass)})}return{initHandlersForCarousel:init}}();function init(){cacheDom();initCarousel()}function cacheDom(){dom={};dom.carousel=$(".nav-carousel");dom.carouselSlides=dom.carousel.find(".slide");dom.carouselSlickList=dom.carousel.find(".slick-list")}function initCarousel(){attachCarouselEventHandlers();dom.carousel.slick({arrows:false,dots:true,infinite:false,mobileFirst:true,slidesToScroll:1,slidesToShow:1,responsive:[{breakpoint:600,settings:{slidesToScroll:2,slidesToShow:2}}]})}function attachCarouselEventHandlers(){dom.carousel.on("afterChange",setCurrentSlides);dom.carousel.on("init",function(){carouselDragHandler.initHandlersForCarousel({dom:{carousel:dom.carousel}});setCurrentSlides()});$(window).on("resize",function(){setCurrentSlides();carouselDragHandler.initHandlersForCarousel({dom:{carousel:dom.carousel}})})}function setCurrentSlides(){dom.carouselSlides.each(function(i,e){var $e=$(e);if(slideFullyVisible($e)){$e.closest(".slick-slide").addClass("slide-current")}else{$e.closest(".slick-slide").removeClass("slide-current")}})}function slideFullyVisible($slide){var slideLeft=$slide.offset().left;var leftInBounds=slideLeft>0;var rightInBounds=slideLeft+$slide.width()<$(window).width();return leftInBounds&&rightInBounds}init()});